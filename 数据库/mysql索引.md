## 1. MySQL索引

**索引是帮助MySQL高效获取数据的排好序的数据结构。**

在MySQL中采用的是B+tree的数据结构，除了**B+tree**之外还有例如二叉树、红黑树、hash表等数据结构，那么为什么MySQL要采用B+tree，而不是用其他的数据结构呢？或者说其他数据结构有什么缺点呢？

- **二叉树**：在一些条件下，二叉树会退化成链表；
- **红黑树**：对于二叉树的一种改进，但是单节点存储数据少，高度不可控，I/OC可能次数较多；
- **hash表**：hash表虽然做等值查询很快，但是无法实现范围查询，排序，联合索引的最左匹配等：
- **B-tree**：b-tree是一种多路搜索数，它每个节点的存储多个数据，数据的高度降低，但是对于多个节点的范围查找，I/O的次数还是较多，例如要查找的[16,21]范围的，需要先把读取根节点，根据算法找打16所在的节点，然后将该节点加载到内存中，找到16，而查找21则是重复这一过程。

![](..\images\mysql\b-tree.png)



- **B+tree**：B+tree是B-tree的一个变种，与B-tree相比，B+tree的非叶子节点只存储索引key（会有冗余），只有叶子节点才存储数据，且叶子节点，其结构如图：

![](..\images\mysql\b+tree.png)



**而MySQL中使用的B+tree是对原B+tree的一种改进，MySQL在叶子节点之间加上了指针链接，这样对于跨节点的范围查询就无需返回父节点重复遍历，减少了I/O时间。**

在MySQL中一页（一个节点）的大小默认是16kb，指针类型一般也就4或8个字节，若主键为BIGINT也是8个字节，假设叶子节点一个data由1kb，那么高度为3的B+tree可以存储2千万左右的数据，所以通常B+tree的高度为2~4，也就是说通常只需要2到4次I/O就可以查找到数据。

![](..\images\mysql\b+tree2.png)





## 2. MyISAM和InnoDB索引

### 2.1 MyISAM

**MyISAM引擎使用的索引是非聚集索引，即索引和数据是分离的。**其叶子节点存储的是数据的地址，主键索引和非主键索引存储结构类似。

![](..\images\mysql\MyIASM.png)

以MySQL-5.7.26为例，引擎为MyISAM的表，其文件如下：

![image-20201220211144142](..\images\mysql\MyIASM-1.png) 

- .frm：主要用来存储表结构；
- .MYD：存储表中的数据；
- .MYI：存储表中的索引。



### 2.2 InnoDB

**InnoDB引擎使用的索引是聚集索引，即索引和数据是在一起的，其数据存储在<font color="red">主键索引</font>的叶子节点。**而非主键索引存储的叶子节点存储的是主键索引。对于InnoDB如果没有创建索引，MySQL会默认创建主键或者ROWID作为ID。

在MySQL中推荐使用自增整型作为主键，一是因为自增是有序的，插入元素时不会插入到之前节点中，若前面的节点已满，再插入可能会导致节点分裂再平衡，二是整型较小，一个节点可以存储更多的数据。

![](..\images\mysql\InnoDB.png)



引擎为MyISAM的表，其文件如下：

![image-20201220212445439](..\images\mysql\InnoDB-2.png) 

- .frm：主要用来存储表结构；
- .ibd：存储索引和数据，相当于MyIASM中.MYD和.MYI文件的合并。



## 3. 联合索引和最左匹配原则

**联合索引**即将多个索引建在一起，例如一张表有两个非主键索引，分别是id和name，将其合并为联合索引后(id,name)，在查找数据时或先比较索引[id]值的大小，若相同再去比较索引[name]的大小，这就是最左匹配原则

![](..\images\mysql\lh.png)